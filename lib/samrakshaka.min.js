(async()=>{if("undefined"==typeof DOMPurify)return void console.error("Samrakshaka: DOMPurify is not loaded. Please include it before samrakshaka.js");const e=document.querySelector("samrakshaka");if(!e)return void console.warn("Samrakshaka: No <samrakshaka> tag found");const a={mode:e.getAttribute("mode")||"moderate",challenge:e.getAttribute("challenge")||"both",protectedId:e.getAttribute("protected-id")||"content"},t=document.getElementById("shield-message"),n=document.getElementById(a.protectedId);if(!n||!t)return void console.error("Samrakshaka: Missing shield-message or protected content element");const s="samrakshaka_verified",o="samrakshaka_timestamp",r=()=>{t.style.display="none",n.style.display="block",localStorage.setItem(s,"true"),localStorage.setItem(o,Date.now().toString()),setTimeout(()=>{document.dispatchEvent(new CustomEvent("samrakshakaVerified")),document.dispatchEvent(new Event("DOMContentLoaded")),console.log("Samrakshaka: Triggered content rendering")},400)};if("off"!==a.mode&&(()=>{const e="true"===localStorage.getItem(s),a=parseInt(localStorage.getItem(o))||0,t=Date.now();return!!(e&&t-a<864e5)||(localStorage.removeItem(s),localStorage.removeItem(o),!1)})())return console.log("Samrakshaka: Using cached verification"),void r();if("off"===a.mode)return console.log("Samrakshaka: Mode is off, skipping verification"),void r();t.style.display="block",n.style.display="none",console.log("Samrakshaka: Starting verification");const i={isHuman:!1,powPassed:!1,keystrokePassed:!1,canvasPassed:!1};await(async()=>{if("behavior"!==a.challenge&&"both"!==a.challenge)return;let e=0,s=0,o=0,r=0;document.addEventListener("mousemove",()=>e++,{passive:!0}),document.addEventListener("scroll",()=>s++,{passive:!0}),document.addEventListener("touchstart",e=>{e.target.closest(".hamburger, .mobile-menu-container, .mobile-menu-close, .mobile-menu-overlay")||o++},{passive:!0});(()=>{const e=document.createElement("a");e.href="#samrakshaka-trap",e.style.display="none",document.body.appendChild(e),e.addEventListener("click",()=>{i.isHuman=!1,t.textContent=DOMPurify.sanitize("Access Denied: Samrakshaka detected unauthorized access"),t.style.display="block",n.style.display="none",clearInterval(l)})})(),setInterval(()=>r=0,1e4),document.querySelectorAll(".card:not(.hamburger):not(:has(.hamburger, .mobile-menu-container, .mobile-menu-close, .mobile-menu-overlay)), .read-more, .filter-chip").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation(),r++,r>10&&(i.isHuman=!1)})}),await(async()=>{const a=[];let t=null;if(document.addEventListener("keydown",e=>{const n=performance.now();t&&n-t<5e3&&a.push(n-t),t=n},{passive:!0}),await new Promise(e=>setTimeout(e,5e3)),i.isHuman=e>2||s>1||o>1,a.length>2){const e=a.reduce((e,a)=>e+a,0)/a.length,t=a.reduce((a,t)=>a+Math.pow(t-e,2),0)/a.length;i.keystrokePassed=t>1e3,console.log("Samrakshaka: Keystroke variance:",t)}else i.keystrokePassed=!0})()})(),(()=>{if("behavior"===a.challenge||"both"===a.challenge)try{const e=document.createElement("canvas"),a=e.getContext("2d");a.font="14px Arial",a.fillText("Samrakshaka",10,50),a.strokeStyle="rgba(255, 111, 97, 0.5)",a.beginPath(),a.arc(50,50,20,0,2*Math.PI),a.stroke();const t=e.toDataURL();i.canvasPassed=t.length>100&&!t.includes("data:,"),console.log("Samrakshaka: Canvas fingerprint valid:",i.canvasPassed)}catch(e){console.warn("Samrakshaka: Canvas fingerprinting failed",e),i.canvasPassed=!0}})(),await(async()=>{if("pow"!==a.challenge&&"both"!==a.challenge)return;const e=crypto.randomUUID(),t=i.isHuman&&i.keystrokePassed&&i.canvasPassed?"00":"000",n=await(async(e,a,t)=>{let n=0;for(;n<a;){const a=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(n+e));if(Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("").startsWith(t))return n;n++,await new Promise(e=>setTimeout(e,0))}return console.warn("Samrakshaka: PoW timed out after",a,"attempts"),null})(e,1e4,t);if(null!==n){const a=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(n+e)),s=Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("");i.powPassed=s.startsWith(t),console.log("Samrakshaka: PoW passed with difficulty:",t)}})();const l=(()=>{const e=document.querySelector("main");if(!e)return null;const a=e.innerHTML;let s=!0;const o=setInterval(()=>{s?setTimeout(()=>{s=!1},5e3):e.innerHTML!==a&&(i.isHuman=!1,t.textContent=DOMPurify.sanitize("Access Denied: Samrakshaka detected unauthorized DOM changes"),t.style.display="block",n.style.display="none",clearInterval(o))},1e3);return o})();i.isHuman&&("both"===a.challenge&&i.powPassed&&i.keystrokePassed&&i.canvasPassed||"behavior"===a.challenge&&i.keystrokePassed&&i.canvasPassed||"pow"===a.challenge&&i.powPassed)?(console.log("Samrakshaka: Verification passed"),t.style.display="none",n.style.display="block",l&&clearInterval(l),r()):"moderate"===a.mode?setTimeout(()=>{"none"===n.style.display&&(console.warn("Samrakshaka: Verification timeout, proceeding in moderate mode"),t.style.display="none",n.style.display="block",l&&clearInterval(l),r())},1e4):(console.log("Samrakshaka: Verification failed in strict mode"),t.textContent=DOMPurify.sanitize("Access Denied: Samrakshaka detected unauthorized access"),t.style.display="block",n.style.display="none")})();